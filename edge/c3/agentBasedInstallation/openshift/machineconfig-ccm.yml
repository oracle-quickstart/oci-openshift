# 99_openshift-machineconfig_00-master-kubelet-providerid.yaml
# Generated by Butane; do not edit
apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: master
  name: 00-master-oci-kubelet-providerid
spec:
  config:
    ignition:
      version: 3.2.0
    storage:
      files:
        - contents:
            compression: gzip
            source: data:;base64,H4sIAAAAAAAC/1yPUYvaQBCA3/dXTFMf2odkrbSFWlNQE2moJEW9exGRdTO5DBd3w+4YvBP/+yF6IPf0zcPMxzefP8kdGblTvhYeGUKE0EJLLVaKGiHyIkmnRT6LJbKW/sUz7ssb5fNhhw1y5NF1pDEq5aAfWk1h62xHJToqI21NJQRVsL64g97p3XgOYPMbuEYjAABQ1xaC3DI4bBulyTwBHsnzZbi/um4fiaEvKhJZvlyN82m6zZK490UfXAPhXwjGB66to1fFZM0QJqgcOiic0g0GEPo51MztUMpvP39Fgx/foxulbbXsBpKMZ2U0Siq/CqEVw58P8aNRWszEenn9fSNS05GzZo+G4+DfwySdp6vt/0XxmCXpIktiq2koZe90F3wOxMXxFgAA///yWfIkhAEAAA==
          mode: 493
          path: /usr/local/bin/oci-kubelet-providerid
    systemd:
      units:
        - contents: |
            [Unit]
            Description=Fetch kubelet provider id from OCI Metadata

            # Wait for NetworkManager to report it's online
            After=NetworkManager-wait-online.service
            # Run before kubelet
            Before=kubelet.service

            [Service]
            ExecStart=/usr/local/bin/oci-kubelet-providerid
            Type=oneshot

            [Install]
            WantedBy=network-online.target
          enabled: true
          name: oci-kubelet-providerid.service
        - contents: |
            [Unit]
            Description=OCI hostname agent
            Wants=network-online.target
            After=network-online.target

            [Service]
            Type=oneshot
            ExecStart=/usr/bin/bash -c 'OCIHOSTNAME=$(curl -H \"Authorization: Bearer Oracle\" -L http://169.254.169.254/opc/v2/instance/ --retry 10 | jq -r '.displayName') && echo \"$OCIHOSTNAME\" > /etc/hostname'

            [Install]
            WantedBy=multi-user.target
          enabled: true
          name: oci-hostname-update.service

---

# 99_openshift-machineconfig_00-worker-kubelet-providerid.yaml
# Generated by Butane; do not edit
apiVersion: machineconfiguration.openshift.io/v1
kind: MachineConfig
metadata:
  labels:
    machineconfiguration.openshift.io/role: worker
  name: 00-worker-oci-kubelet-providerid
spec:
  config:
    ignition:
      version: 3.2.0
    storage:
      files:
        - contents:
            compression: gzip
            source: data:;base64,H4sIAAAAAAAC/1yPUYvaQBCA3/dXTFMf2odkrbSFWlNQE2moJEW9exGRdTO5DBd3w+4YvBP/+yF6IPf0zcPMxzefP8kdGblTvhYeGUKE0EJLLVaKGiHyIkmnRT6LJbKW/sUz7ssb5fNhhw1y5NF1pDEq5aAfWk1h62xHJToqI21NJQRVsL64g97p3XgOYPMbuEYjAABQ1xaC3DI4bBulyTwBHsnzZbi/um4fiaEvKhJZvlyN82m6zZK490UfXAPhXwjGB66to1fFZM0QJqgcOiic0g0GEPo51MztUMpvP39Fgx/foxulbbXsBpKMZ2U0Siq/CqEVw58P8aNRWszEenn9fSNS05GzZo+G4+DfwySdp6vt/0XxmCXpIktiq2koZe90F3wOxMXxFgAA///yWfIkhAEAAA==
          mode: 493
          path: /usr/local/bin/oci-kubelet-providerid
    systemd:
      units:
        - contents: |
            [Unit]
            Description=Fetch kubelet provider id from OCI Metadata

            # Wait for NetworkManager to report it's online
            After=NetworkManager-wait-online.service
            # Run before kubelet
            Before=kubelet.service

            [Service]
            ExecStart=/usr/local/bin/oci-kubelet-providerid
            Type=oneshot

            [Install]
            WantedBy=network-online.target
          enabled: true
          name: oci-kubelet-providerid.service
        - contents: |
            [Unit]
            Description=OCI hostname agent
            Wants=network-online.target
            After=network-online.target

            [Service]
            Type=oneshot
            ExecStart=/usr/bin/bash -c 'OCIHOSTNAME=$(curl -H \"Authorization: Bearer Oracle\" -L http://169.254.169.254/opc/v2/instance/ --retry 10 | jq -r '.displayName') && echo \"$OCIHOSTNAME\" > /etc/hostname'

            [Install]
            WantedBy=multi-user.target
          enabled: true
          name: oci-hostname-update.service

---